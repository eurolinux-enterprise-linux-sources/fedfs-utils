.\"@(#)fedfs-domainroot.8"
.\"
.\" @file doc/man/fedfs-domainroot.8
.\" @brief man page for fedfs-domainroot tool
.\"

.\"
.\" Copyright 2013 Oracle.  All rights reserved.
.\"
.\" This file is part of fedfs-utils.
.\"
.\" fedfs-utils is free software; you can redistribute it and/or modify
.\" it under the terms of the GNU General Public License version 2.0 as
.\" published by the Free Software Foundation.
.\"
.\" fedfs-utils is distributed in the hope that it will be useful, but
.\" WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License version 2.0 for more details.
.\"
.\" You should have received a copy of the GNU General Public License
.\" version 2.0 along with fedfs-utils.  If not, see:
.\"
.\"	http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt
.\"
.TH FEDFS-DOMAINROOT 8 "@pubdate@"
.SH NAME
fedfs-domainroot \- set up FedFS domain root infrastructure
.SH SYNOPSIS
.B fedfs-domainroot
.RB [ \-h ", " \-\-help ]
.RB [ \-\-version ]
.P
.B fedfs-domainroot
.RB [ \-\-silent ]
.RB [ \-\-statedir =
.IR statedir ]
.B add
.I domainname
.P
.B fedfs-domainroot
.RB [ \-\-silent ]
.RB [ \-\-statedir =
.IR statedir ]
.B remove
.I domainname
.RB [ \-\-force ]
.P
.B fedfs-domainroot
.RB [ \-\-silent ]
.RB [ \-\-statedir =
.IR statedir ]
.B status
.P
.B fedfs-domainroot
.RB [ \-\-silent ]
.RB [ \-\-statedir =
.IR statedir ]
.B clean
.RB [ \-\-force ]
.SH INTRODUCTION
RFC 5716 introduces the Federated File System (FedFS, for short).
FedFS is an extensible standardized mechanism
by which system administrators construct
a coherent namespace across multiple file servers using
.IR "file system referrals" .
For further details, see
.BR fedfs (7).
.P
The top directory of a FedFS domain namespace is known as a
.I domain root
directory.
FedFS-enabled clients discover the fileserver that exports
a FedFS domain's root directory using a DNS SRV query.
Using a well-known export path,
clients then mount the domain root directory
on that fileserver in the normal fashion.
.P
After a filesystem client mounts a domain's root directory,
applications on that client descend into the domain's name space
starting in that directory,
and are directed transparently to exports on other fileservers.
.P
Further information about domain roots is available in
.BR fedfs (7).
.P
.SH DESCRIPTION
A single fileserver may host domain root directories
for one or more FedFS domains.
The
.BR fedfs-domainroot (8)
command is a convenient way to securely manage domain root exports
on a Linux NFS fileserver.
FedFS itself is agnostic about the underlying file-access protocol,
but the
.BR fedfs-domainroot (8)
command supports only NFS at this time.
.P
FedFS domain root directories are exported using a standard well-known
pathname to make it simple for clients to find them.
The first component of the domain root's export pathname is always
.IR /.domainroot .
The second component is a FedFS domain name.
.P
For instance, the export pathname of the domain root of the
.I example.net
FedFS domain is
.IR /.domainroot/example.net .
.SS Operation
The
.B add
subcommand creates a directory under
.I @statedir@/domainroots
where the contents of the domain root directory reside.
A directory is also set up under
.I /.domainroot
for each doman root directory.
.BR fedfs-domainroot (8)
bind-mounts the domain root directory under
.I @statedir@/domainroots,
then exports the directory under
.IR /.domainroot .
.P
In this way, each domain root directory is exported via a well-known pathname,
and can have its own export settings separate from other domain root directories,
including security settings and client and network designations.
These can be modified by editing
.I /etc/exports
after the
domain root export is created.
.P
The
.BR fedfs-domainroot (8)
command must run as root in order to create and remove NFS exports
and entries in
.IR /etc/fstab .
.SS Subcommands
Valid
.BR fedfs-domainroot (8)
subcommands are:
.IP "\fBclean\fP"
Remove the
.I /.domainroot
directory and other infrastructure (as long as it is empty).
The user is asked to confirm before action is taken.
.IP
By default, this process stops when a step encounters an error.
Adding the
.B \-\-force
option forces the process to try each step even if an error occurs,
and bypasses the confirmation request.
.IP "\fBstatus\fP"
Display the status of the domain root infrastructure on the local system.
This includes whether NFSD is running, and what domain root directories
are currently configured and exported.
This subcommand takes no arguments.
.IP "\fBadd\fP"
Create a new FedFS domain root directory under
.I /.domainroot
and export it.
This subcommand takes a FedFS domain name as an argument.
.IP "\fBremove\fP"
Remove an existing FedFS domain root directory from
.IR /.domainroot .
This subcommand takes a FedFS domain name as an argument.
The user is asked to confirm before action is taken.
.IP
By default, this process stops when a step encounters an error.
Adding the
.B \-\-force
option forces the process to try each step even if an error occurs,
and bypasses the confirmation request.
.SS Command line options
The following options are specified before the subcommand on the command line.
.IP "\fB\-h, \-\-help"
Display usage and copyright information, then exit.
.IP "\fB\-\-version"
Display fedfs-utils version information, then exit.
.IP "\fB\-\-silent"
Process quietly.
.IP "\fB\-\-statedir=\fIstate-directory\fP"
Find FedFS domain root directories on the local system in the
.I domainroots
subdirectory of the specified directory.
By default, the state directory is
.IR @statedir@ .
.SH EXIT CODES
The
.BR fedfs-domainroot (8)
command returns one of two values upon exit.
.TP
.B 0
The requested subcommand succeeded.
.TP
.B 1
The requested subcommand failed.
.SH EXAMPLES
Suppose you are the FedFS administrator of the
.I example.net
FedFS domain.
After you have chosen a reliable NFS fileserver to serve your
FedFS domain root directory, log in on that fileserver as root
and ensure that NFSD is running.
.P
To create a new FedFS domain root for the
.I example.net
domain, use:
.RS
.sp
# fedfs-domainroot --silent add example.net
.br
Added domain root for FedFS domain "example.net"
.br
#
.sp
.RE
To populate the new domain root, change your current directory to
.IR /.domainroot/example.net ,
then add junctions with the
.BR nfsref (8)
command on the fileserver.
.P
You can list the domain roots that are currently exported
by your fileserver with:
.RS
.sp
# fedfs-domainroot --silent status
.br
FedFS domain roots:
.br
        example.net is exported with options
              *(ro,subtree_check,mp,insecure,sec=sys:none)
.br
#
.sp
.RE
When you want to remove this domain root (say, because you have
moved it to another fileserver), remove it's contents, then use:
.RS
.sp
# fedfs-domainroot remove example.net
.br
Removed domain root for FedFS domain "example.net"
.br
#
.RE
.SH DOMAIN ROOT DISCOVERY
To enable discovery of new domain roots
by FedFS-enabled file-access clients,
a DNS SRV record must be added to an appropriate authoritative DNS server.
.P
If you created your domain root on the fileserver named
.IR foo.example.net ,
a record for the above domain root should be added to the DNS
server authoritative for the
.I example.net
domain.
Such a record might look like
.RS
.sp
 _nfs-domainroot._tcp	IN SRV	0 0 2049	foo.example.net.
.sp
.RE
Adding DNS SRV records is outside the scope of the
.BR fedfs-domainroot (8)
command.
Consult with your network administrator for details
on how to add appropriate DNS SRV records for your FedFS domain root.
.SH SECURITY
FedFS domain root exports created by
.BR fedfs-domainroot (8)
are exported with
.BR *(ro,insecure,subtree_check,sec=sys:none) .
FedFS standards recommend that
FedFS domain root directories should be globally readable.
Specific access restrictions typically occur lower in a domain's name space.
.P
However, fileserver administrators can alter
a domain root export's security settings
by editing a domain root export's entry in
.IR /etc/exports ,
and then refreshing the kernel's export cache with
.BR "exportfs -r" .
.P
For example, if the domain root fileserver has Kerberos configured,
an administrator might change a domain root export's
.B sec=
option to
.BR sec=krb5p:krb5i:krb5:sys:none .
Or, to restrict the range of clients that can access the
domain root, an administrator might replace the leading
.B *
with a specific netgroup or IP network designation.
.P
It is recommended to keep the
.B subtree_check
export option.
Refer to
.BR exports (5)
for details.
.SH FILES
.TP
.I @statedir@/domainroots
directory containing domain root directories
.TP
.I /.domainroot
directory containing domain root exports
.SH "SEE ALSO"
.BR fedfs (7),
.BR nfsref (8),
.BR rpc.fedfsd (8),
.BR exportfs (8),
.BR exports (5)
.sp
RFC 6641 for the specification of FedFS DNS SRV records
.SH COLOPHON
This page is part of the fedfs-utils package.
A description of the project and information about reporting bugs
can be found at
.IR http://wiki.linux-nfs.org/wiki/index.php/FedFsUtilsProject .
.SH "AUTHOR"
Chuck Lever <chuck.lever@oracle.com>
